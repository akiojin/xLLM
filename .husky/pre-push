#!/usr/bin/env sh
set -e

if [ "${HUSKY:-}" = "0" ]; then
  echo "HUSKY=0 is not allowed in this repo." >&2
  exit 1
fi

# Run the full local gate before pushing.
branch_name=$(git rev-parse --abbrev-ref HEAD 2>/dev/null || echo "")
case "$branch_name" in
  feature/SPEC-[a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9])
    spec_id=${branch_name#feature/}
    TASKS="specs/${spec_id}/tasks.md" make quality-checks
    ;;
  *)
    TASKS="" make quality-checks
    ;;
esac
