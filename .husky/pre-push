#!/usr/bin/env sh
set -e

if [ "${HUSKY:-}" = "0" ]; then
  echo "HUSKY=0 is not allowed in this repo." >&2
  exit 1
fi

BASE_REF=""
if git rev-parse --verify -q origin/feature/download-progress >/dev/null; then
  BASE_REF="origin/feature/download-progress"
elif git rev-parse --verify -q origin/develop >/dev/null; then
  BASE_REF="origin/develop"
fi

if [ -z "$BASE_REF" ]; then
  echo "⚠️  Could not determine base ref for linting; skipping pre-push checks."
  exit 0
fi

# Lint gate before pushing (only changed markdown)
bash .specify/scripts/checks/check-markdown.sh --range "${BASE_REF}..HEAD"
bash .specify/scripts/checks/check-commits.sh --from "$BASE_REF" --to HEAD
