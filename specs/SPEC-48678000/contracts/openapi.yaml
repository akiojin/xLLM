openapi: 3.0.3
info:
  title: LLM Router Model Resolution API
  description: |
    モデル自動解決機能のAPI仕様。

    モデルのダウンロード状態確認と、
    サポートモデル一覧の取得を行う。
  version: 0.1.0

servers:
  - url: http://localhost:8080
    description: ローカル開発サーバー

paths:
  /v0/models/{model_id}/status:
    get:
      summary: モデル解決状態の取得
      description: |
        指定モデルの解決状態（ローカル存在、ダウンロード中、エラー等）を取得する。
      operationId: getModelResolutionStatus
      tags:
        - Models
      security:
        - bearerAuth: []
      parameters:
        - name: model_id
          in: path
          required: true
          schema:
            type: string
          description: モデルID
      responses:
        '200':
          description: モデル解決状態
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelResolutionStatus'
        '404':
          description: モデルが未定義
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v0/supported-models:
    get:
      summary: サポートモデル一覧の取得
      description: |
        supported_models.jsonに定義されたモデル一覧を取得する。
      operationId: listSupportedModels
      tags:
        - Models
      security:
        - bearerAuth: []
      responses:
        '200':
          description: サポートモデル一覧
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupportedModelsResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer

  schemas:
    ModelResolutionStatus:
      type: object
      required:
        - model_id
        - status
      properties:
        model_id:
          type: string
          description: モデルID
        status:
          type: string
          enum: [local, downloading, completed, error]
          description: |
            解決状態:
            - local: ローカルに存在
            - downloading: ダウンロード中
            - completed: ダウンロード完了
            - error: エラー発生
        progress:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: ダウンロード進捗率（0.0-1.0）
        downloaded_bytes:
          type: integer
          description: ダウンロード済みバイト数
        total_bytes:
          type: integer
          description: 総バイト数
        local_path:
          type: string
          description: ローカルファイルパス
        error_message:
          type: string
          description: エラーメッセージ（エラー時のみ）
      example:
        model_id: "llama-3.2-1b"
        status: "downloading"
        progress: 0.45
        downloaded_bytes: 394200000
        total_bytes: 876000000

    SupportedModelsResponse:
      type: object
      properties:
        models:
          type: array
          items:
            $ref: '#/components/schemas/SupportedModel'

    SupportedModel:
      type: object
      required:
        - id
        - name
        - source
      properties:
        id:
          type: string
          description: モデルID
        name:
          type: string
          description: 表示名
        source:
          type: string
          enum: [hf_gguf, hf_safetensors, hf_onnx, predefined]
          description: モデルソース種別
        repo_id:
          type: string
          description: HuggingFace リポジトリID
        required_vram_mb:
          type: integer
          description: 必要VRAM（MB）
        tags:
          type: array
          items:
            type: string
          description: タグ一覧
        is_local:
          type: boolean
          description: ローカルに存在するか
      example:
        id: "llama-3.2-1b"
        name: "Llama 3.2 1B"
        source: "hf_gguf"
        repo_id: "bartowski/Llama-3.2-1B-Instruct-GGUF"
        required_vram_mb: 2048
        tags: ["chat", "instruct"]
        is_local: true

    Error:
      type: object
      required:
        - error
      properties:
        error:
          type: object
          required:
            - message
            - type
          properties:
            message:
              type: string
            type:
              type: string
            code:
              type: string
